<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·Éí·Éê·Éú·É†·Éò·Éí·Éò - ·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò ·Éì·Éê MCG</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        /* Colorful Login Page */
        .login-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #27ae60, #e74c3c);
        }
        
        .login-title {
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #27ae60, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .login-subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .login-input {
            padding: 14px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            width: 100%;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .login-button {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }
        
        /* Main App Styling */
        .main-app {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header with logout */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .app-title {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logout-button {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        /* Notification Popup - 2cm from top */
        .notification {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 16px 24px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: top 0.3s ease-out;
            max-width: 500px;
            width: 90%;
            text-align: center;
            font-size: 15px;
            font-weight: 500;
        }
        
        .notification.show {
            top: 20px; /* About 2cm from top */
        }
        
        /* Flexible Schedule Layout */
        .table-container {
            width: 100%;
        }
        
        .schedule-row {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-bottom: 40px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .schedule-row::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #27ae60, #e74c3c);
            border-radius: 12px 12px 0 0;
        }
        
        .month-header {
            position: absolute;
            top: -30px;
            left: 20px;
            background: #2c3e50;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        /* Date Cells Container */
        .dates-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            width: calc(100% - 120px);
            margin-left: 120px;
        }
        
        /* Date Column */
        .date-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }
        
        .date-header {
            background: #ecf0f1;
            color: #2c3e50;
            font-weight: 600;
            font-size: 13px;
            padding: 8px;
            width: 100%;
            text-align: center;
            border-radius: 6px 6px 0 0;
        }
        
        /* Activity labels column */
        .activity-labels {
            position: absolute;
            left: 0;
            top: 20px;
            width: 120px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .activity-label {
            background: #f8f9fa;
            font-weight: bold;
            text-align: right;
            padding: 12px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            border-right: 2px solid #e1e8ed;
            font-size: 14px;
        }
        
        .german-label {
            color: #27ae60;
            background: #f8f9fa;
        }
        
        .mcg-label {
            color: #e74c3c;
            background: #f8f9fa;
        }
        
        /* Activity cells */
        .activity-cell {
            width: 100%;
            height: 50px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            position: relative;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0 0 6px 6px;
        }
        
        .activity-cell:hover {
            transform: scale(1.05);
            z-index: 2;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* German lesson cells - Green with GER text */
        .german-cell.empty {
            background-color: white;
            border: 2px solid #e1e8ed;
        }
        
        .german-cell.filled {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: 2px solid #27ae60;
            font-weight: bold;
        }
        
        /* MCG shift cells - Red with MCG text */
        .mcg-cell.empty {
            background-color: white;
            border: 2px solid #e1e8ed;
        }
        
        .mcg-cell.filled {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: 2px solid #e74c3c;
            font-weight: bold;
        }
        
        /* Comment indicator */
        .has-comment::after {
            content: "üí¨";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* Comment Popup Modal */
        .comment-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .comment-modal-overlay.active {
            display: flex;
        }
        
        .comment-modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }
        
        .comment-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .comment-modal-title {
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
        }
        
        .comment-date-info {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .close-comment-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #95a5a6;
            line-height: 1;
        }
        
        .comment-textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
            font-family: inherit;
        }
        
        .comment-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .comment-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .comment-modal-btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .save-comment-btn {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .delete-comment-btn {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .cancel-comment-btn {
            background: #95a5a6;
            color: white;
        }
        
        .comment-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Confirmation Modal */
        .confirm-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .confirm-modal-overlay.active {
            display: flex;
        }
        
        .confirm-modal {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .confirm-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .confirm-modal-title {
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-confirm-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #95a5a6;
        }
        
        .confirm-modal-message {
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confirm-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .confirm-modal-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .confirm-btn {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .cancel-confirm-btn {
            background: #95a5a6;
            color: white;
        }
        
        .confirm-modal-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .dates-container {
                margin-left: 100px;
                width: calc(100% - 100px);
            }
            
            .activity-labels {
                width: 100px;
            }
            
            .date-column {
                min-width: 50px;
            }
            
            .activity-label {
                padding: 10px;
                font-size: 13px;
            }
            
            .date-header {
                font-size: 12px;
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page - Colorful Design -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-title">·Éí·Éê·Éú·É†·Éò·Éí·Éò·É° ·Éõ·Éî·Éú·Éî·ÉØ·Éî·É†·Éò</div>
            <div class="login-subtitle">·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò ·Éì·Éê MCG</div>
            <form id="loginForm" class="login-form">
                <input type="text" id="username" class="login-input" placeholder="·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò" required>
                <input type="password" id="password" class="login-input" placeholder="·Éû·Éê·É†·Éù·Éö·Éò" required>
                <button type="submit" class="login-button">·É®·Éî·É°·Éï·Éö·Éê</button>
            </form>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <!-- Header -->
        <div class="app-header">
            <div class="app-title">·Éí·Éê·Éú·É†·Éò·Éí·Éò - ·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò ·Éì·Éê MCG</div>
            <div class="user-info">
                <div style="font-weight: 500;">Alex</div>
                <button id="logoutBtn" class="logout-button">·Éí·Éê·É°·Éï·Éö·Éê</button>
            </div>
        </div>
        
        <!-- Schedule Table Container -->
        <div class="table-container" id="tableContainer">
            <!-- Schedule rows will be generated here -->
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Comment Popup Modal -->
    <div id="commentModal" class="comment-modal-overlay">
        <div class="comment-modal">
            <div class="comment-modal-header">
                <div>
                    <div class="comment-modal-title" id="commentModalTitle"></div>
                    <div class="comment-date-info" id="commentDateInfo"></div>
                </div>
                <button id="closeCommentModal" class="close-comment-modal">√ó</button>
            </div>
            <textarea id="commentTextarea" class="comment-textarea" placeholder="·Éì·Éê·É¨·Éî·É†·Éî·Éó ·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò..."></textarea>
            <div class="comment-modal-buttons">
                <button id="deleteCommentBtn" class="comment-modal-btn delete-comment-btn">·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò·É° ·É¨·Éê·É®·Éö·Éê</button>
                <button id="cancelCommentBtn" class="comment-modal-btn cancel-comment-btn">·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê</button>
                <button id="saveCommentBtn" class="comment-modal-btn save-comment-btn">·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="confirm-modal-overlay">
        <div class="confirm-modal">
            <div class="confirm-modal-header">
                <div class="confirm-modal-title">·Éì·Éê·Éì·Éê·É°·É¢·É£·É†·Éî·Éë·Éê</div>
                <button id="closeConfirmModal" class="close-confirm-modal">√ó</button>
            </div>
            <div id="modalMessage" class="confirm-modal-message"></div>
            <div class="confirm-modal-buttons">
                <button id="cancelConfirmBtn" class="confirm-modal-btn cancel-confirm-btn">·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê</button>
                <button id="confirmDeleteBtn" class="confirm-modal-btn confirm-btn">·É¨·Éê·É®·Éö·Éê</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBePd7QF1DhWXmqwEYShA0oOKYeS8hAOLg",
            authDomain: "shifts-c5fb8.firebaseapp.com",
            databaseURL: "https://shifts-c5fb8-default-rtdb.firebaseio.com",
            projectId: "shifts-c5fb8",
            storageBucket: "shifts-c5fb8.firebasestorage.app",
            messagingSenderId: "44422916256",
            appId: "1:44422916256:web:1f430332196810435141c5",
            measurementId: "G-7ZLR5CKNTD"
        };
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }
        
        // Constants
        const VALID_USERNAME = "alex";
        const VALID_PASSWORD = "2911";
        
        // Current date
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth();
        const currentDay = today.getDate();
        
        // Georgian month names (full)
        const monthNames = ["·Éò·Éê·Éú·Éï·Éê·É†·Éò", "·Éó·Éî·Éë·Éî·É†·Éï·Éê·Éö·Éò", "·Éõ·Éê·É†·É¢·Éò", "·Éê·Éû·É†·Éò·Éö·Éò", "·Éõ·Éê·Éò·É°·Éò", "·Éò·Éï·Éú·Éò·É°·Éò", 
                           "·Éò·Éï·Éö·Éò·É°·Éò", "·Éê·Éí·Éï·Éò·É°·É¢·Éù", "·É°·Éî·É•·É¢·Éî·Éõ·Éë·Éî·É†·Éò", "·Éù·É•·É¢·Éù·Éõ·Éë·Éî·É†·Éò", "·Éú·Éù·Éî·Éõ·Éë·Éî·É†·Éò", "·Éì·Éî·Éô·Éî·Éõ·Éë·Éî·É†·Éò"];
        
        // Data storage
        let scheduleData = {};
        let commentsData = {};
        let currentUser = null;
        let pendingDelete = null;
        let currentCommentCell = null;
        
        // Helper functions
        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }
        
        function getDateKey(year, month, day) {
            return `${year}-${month + 1}-${day}`;
        }
        
        // Notification function - 2cm from top
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            if (type === 'error') {
                notification.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            } else if (type === 'success') {
                notification.style.background = 'linear-gradient(90deg, #27ae60, #2ecc71)';
            } else {
                notification.style.background = 'linear-gradient(90deg, #667eea, #764ba2)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Data Management Functions
        async function saveDataToFirebase() {
            if (!currentUser) return;
            
            try {
                const db = firebase.database();
                const userId = currentUser.name.toLowerCase();
                
                await db.ref(`schedules/${userId}`).set({
                    schedule: scheduleData,
                    comments: commentsData,
                    lastUpdated: new Date().toISOString()
                });
                
                console.log("Data saved to Firebase");
            } catch (error) {
                console.error("Error saving to Firebase:", error);
                saveDataToLocalStorage();
            }
        }
        
        async function loadDataFromFirebase() {
            if (!currentUser) return;
            
            try {
                const db = firebase.database();
                const userId = currentUser.name.toLowerCase();
                
                const snapshot = await db.ref(`schedules/${userId}`).once('value');
                const data = snapshot.val();
                
                if (data) {
                    scheduleData = data.schedule || {};
                    commentsData = data.comments || {};
                    console.log("Data loaded from Firebase");
                }
            } catch (error) {
                console.error("Error loading from Firebase:", error);
                loadDataFromLocalStorage();
            }
        }
        
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem('germanMcgSchedule', JSON.stringify(scheduleData));
                localStorage.setItem('germanMcgComments', JSON.stringify(commentsData));
                console.log("Data saved to localStorage");
            } catch (e) {
                console.error("Error saving to localStorage:", e);
            }
        }
        
        function loadDataFromLocalStorage() {
            try {
                const savedSchedule = localStorage.getItem('germanMcgSchedule');
                const savedComments = localStorage.getItem('germanMcgComments');
                
                if (savedSchedule) scheduleData = JSON.parse(savedSchedule);
                if (savedComments) commentsData = JSON.parse(savedComments);
                
                console.log("Data loaded from localStorage");
            } catch (e) {
                console.log("No saved data found in localStorage");
            }
        }
        
        // Authentication
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                currentUser = { name: 'Alex' };
                showNotification('·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·Éò·Éó ·É®·Éî·ÉÆ·Éï·Éî·Éì·Éò·Éó ·É°·Éò·É°·É¢·Éî·Éõ·Éê·É®·Éò!', 'success');
                
                await loadDataFromFirebase();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                createSchedule();
            } else {
                showNotification('·Éê·É†·Éê·É°·É¨·Éù·É†·Éò ·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éö·Éò·É° ·É°·Éê·ÉÆ·Éî·Éö·Éò ·Éê·Éú ·Éû·Éê·É†·Éù·Éö·Éò!', 'error');
            }
        }
        
        function handleLogout() {
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('·É°·Éò·É°·É¢·Éî·Éõ·Éò·Éì·Éê·Éú ·Éí·Éê·Éõ·Éù·É°·É£·Éö·Éò ·ÉÆ·Éê·É†·Éó', 'info');
        }
        
        // Flexible Schedule Layout
        function createSchedule() {
            const container = document.getElementById('tableContainer');
            container.innerHTML = '';
            
            // Get all days from current date to August
            const allDays = [];
            let year = currentYear;
            let month = currentMonth;
            
            while (true) {
                const daysInMonth = getDaysInMonth(year, month);
                const monthInfo = {
                    year: year,
                    month: month,
                    name: monthNames[month],
                    days: daysInMonth
                };
                
                const startDay = (year === currentYear && month === currentMonth) ? currentDay : 1;
                
                for (let day = startDay; day <= daysInMonth; day++) {
                    allDays.push({
                        year: year,
                        month: month,
                        day: day,
                        monthName: monthInfo.name
                    });
                }
                
                if (month === 7) break;
                
                month++;
                if (month > 11) {
                    month = 0;
                    year++;
                }
            }
            
            // Group dates by month and create flexible rows
            let monthGroups = [];
            let currentGroup = null;
            
            allDays.forEach(day => {
                const monthKey = `${day.year}-${day.month}`;
                if (!currentGroup || currentGroup.monthKey !== monthKey) {
                    if (currentGroup) {
                        monthGroups.push(currentGroup);
                    }
                    currentGroup = {
                        monthKey: monthKey,
                        monthName: day.monthName,
                        days: []
                    };
                }
                currentGroup.days.push(day);
            });
            
            if (currentGroup) {
                monthGroups.push(currentGroup);
            }
            
            // Create schedule rows for each month group
            monthGroups.forEach(group => {
                createMonthScheduleRow(container, group);
            });
        }
        
        function createMonthScheduleRow(container, monthGroup) {
            // Calculate available width for dates
            const containerWidth = container.clientWidth || window.innerWidth - 40;
            const dateWidth = 62; // Each date column width
            const labelWidth = 120;
            const maxDatesPerRow = Math.max(1, Math.floor((containerWidth - labelWidth) / dateWidth));
            
            const totalDays = monthGroup.days.length;
            const totalRows = Math.ceil(totalDays / maxDatesPerRow);
            
            for (let row = 0; row < totalRows; row++) {
                const startIdx = row * maxDatesPerRow;
                const endIdx = Math.min(startIdx + maxDatesPerRow, totalDays);
                const rowDays = monthGroup.days.slice(startIdx, endIdx);
                
                const scheduleRow = document.createElement('div');
                scheduleRow.className = 'schedule-row';
                
                // Month header for first row of the month
                if (row === 0) {
                    const monthHeader = document.createElement('div');
                    monthHeader.className = 'month-header';
                    monthHeader.textContent = monthGroup.monthName;
                    scheduleRow.appendChild(monthHeader);
                }
                
                // Activity labels on the left
                const activityLabels = document.createElement('div');
                activityLabels.className = 'activity-labels';
                
                const germanLabel = document.createElement('div');
                germanLabel.className = 'activity-label german-label';
                germanLabel.textContent = '·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò';
                activityLabels.appendChild(germanLabel);
                
                const mcgLabel = document.createElement('div');
                mcgLabel.className = 'activity-label mcg-label';
                mcgLabel.textContent = 'MCG';
                activityLabels.appendChild(mcgLabel);
                
                scheduleRow.appendChild(activityLabels);
                
                // Dates container
                const datesContainer = document.createElement('div');
                datesContainer.className = 'dates-container';
                
                // Create date columns
                rowDays.forEach(dayInfo => {
                    const dateKey = getDateKey(dayInfo.year, dayInfo.month, dayInfo.day);
                    
                    const dateColumn = document.createElement('div');
                    dateColumn.className = 'date-column';
                    
                    // Date header
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'date-header';
                    dateHeader.textContent = dayInfo.day;
                    dateColumn.appendChild(dateHeader);
                    
                    // German cell
                    const hasGerman = scheduleData[dateKey] === 'german';
                    const hasGermanComment = commentsData[`${dateKey}_german`];
                    
                    const germanCell = document.createElement('div');
                    germanCell.className = `activity-cell german-cell ${hasGerman ? 'filled' : 'empty'}`;
                    if (hasGerman) germanCell.textContent = 'GER';
                    if (hasGermanComment) germanCell.classList.add('has-comment');
                    
                    germanCell.dataset.date = dateKey;
                    germanCell.dataset.type = 'german';
                    
                    germanCell.addEventListener('click', handleCellClick);
                    germanCell.addEventListener('contextmenu', handleRightClick);
                    
                    dateColumn.appendChild(germanCell);
                    
                    // MCG cell
                    const hasMcg = scheduleData[dateKey] === 'mcg';
                    const hasMcgComment = commentsData[`${dateKey}_mcg`];
                    
                    const mcgCell = document.createElement('div');
                    mcgCell.className = `activity-cell mcg-cell ${hasMcg ? 'filled' : 'empty'}`;
                    if (hasMcg) mcgCell.textContent = 'MCG';
                    if (hasMcgComment) mcgCell.classList.add('has-comment');
                    
                    mcgCell.dataset.date = dateKey;
                    mcgCell.dataset.type = 'mcg';
                    
                    mcgCell.addEventListener('click', handleCellClick);
                    mcgCell.addEventListener('contextmenu', handleRightClick);
                    
                    dateColumn.appendChild(mcgCell);
                    
                    datesContainer.appendChild(dateColumn);
                });
                
                scheduleRow.appendChild(datesContainer);
                container.appendChild(scheduleRow);
            }
        }
        
        // Event handlers
        function handleCellClick(e) {
            const cell = e.currentTarget;
            const date = cell.dataset.date;
            const type = cell.dataset.type;
            
            const hasActivity = scheduleData[date] === type;
            const hasComment = commentsData[`${date}_${type}`];
            
            if (hasActivity && hasComment) {
                pendingDelete = { date, type, cell };
                
                const [year, month, day] = date.split('-');
                const georgianMonth = monthNames[parseInt(month) - 1];
                
                document.getElementById('modalMessage').textContent = 
                    `${day} ${georgianMonth}, ${year} - ·Éê·Éõ ·Éì·É¶·Éî·É° ·Éê·É•·Éï·É° ·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò. ·Éì·Éê·É†·É¨·Éõ·É£·Éú·Éî·Éë·É£·Éö·Éò ·ÉÆ·Éê·É†·Éó, ·É†·Éù·Éõ ·Éí·É°·É£·É†·Éó "${type === 'german' ? '·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò' : 'MCG'}" ·É¨·Éê·É®·Éö·Éê?`;
                
                document.getElementById('confirmModal').classList.add('active');
            } else {
                toggleEvent(cell, date, type);
            }
        }
        
        function handleRightClick(e) {
            e.preventDefault();
            const cell = e.currentTarget;
            const date = cell.dataset.date;
            const type = cell.dataset.type;
            
            currentCommentCell = cell;
            
            const commentKey = `${date}_${type}`;
            const currentComment = commentsData[commentKey] || '';
            const [year, month, day] = date.split('-');
            const georgianMonth = monthNames[parseInt(month) - 1];
            
            // Show comment popup modal
            document.getElementById('commentModalTitle').textContent = 
                `${type === 'german' ? '·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò' : 'MCG'} - ·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò`;
            document.getElementById('commentDateInfo').textContent = 
                `${day} ${georgianMonth}, ${year}`;
            document.getElementById('commentTextarea').value = currentComment;
            
            // Show/hide delete button based on whether comment exists
            const deleteBtn = document.getElementById('deleteCommentBtn');
            if (currentComment.trim()) {
                deleteBtn.style.display = 'block';
            } else {
                deleteBtn.style.display = 'none';
            }
            
            document.getElementById('commentModal').classList.add('active');
        }
        
        async function toggleEvent(cell, date, type) {
            const hasActivity = scheduleData[date] === type;
            
            if (hasActivity) {
                // Remove activity
                delete scheduleData[date];
                cell.className = `activity-cell ${type}-cell empty`;
                cell.textContent = '';
                
                // Remove comment
                delete commentsData[`${date}_${type}`];
                cell.classList.remove('has-comment');
                
                showNotification(`${type === 'german' ? '·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò' : 'MCG'} ·É¨·Éê·Éò·É®·Éê·Éö·Éê`, 'info');
            } else {
                // Add activity
                scheduleData[date] = type;
                cell.className = `activity-cell ${type}-cell filled`;
                cell.textContent = type === 'german' ? 'GER' : 'MCG';
                
                // Remove other type if exists
                const otherType = type === 'german' ? 'mcg' : 'german';
                const otherCells = document.querySelectorAll(`[data-date="${date}"][data-type="${otherType}"]`);
                otherCells.forEach(otherCell => {
                    otherCell.className = `activity-cell ${otherType}-cell empty`;
                    otherCell.textContent = '';
                    delete commentsData[`${date}_${otherType}`];
                    otherCell.classList.remove('has-comment');
                });
                
                showNotification(`${type === 'german' ? '·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò' : 'MCG'} ·Éì·Éê·Éî·Éõ·Éê·É¢·Éê`, 'success');
            }
            
            await saveDataToFirebase();
            saveDataToLocalStorage();
        }
        
        // Comment modal handlers
        function saveComment() {
            if (!currentCommentCell) return;
            
            const date = currentCommentCell.dataset.date;
            const type = currentCommentCell.dataset.type;
            const comment = document.getElementById('commentTextarea').value.trim();
            
            if (comment) {
                commentsData[`${date}_${type}`] = comment;
                currentCommentCell.classList.add('has-comment');
                showNotification('·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò ·É®·Éî·Éú·Éê·ÉÆ·É£·Éö·Éò·Éê', 'success');
            } else {
                delete commentsData[`${date}_${type}`];
                currentCommentCell.classList.remove('has-comment');
                showNotification('·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò ·É¨·Éê·Éò·É®·Éê·Éö·Éê', 'info');
            }
            
            saveDataToFirebase();
            saveDataToLocalStorage();
            closeCommentModal();
        }
        
        function deleteComment() {
            if (!currentCommentCell) return;
            
            const date = currentCommentCell.dataset.date;
            const type = currentCommentCell.dataset.type;
            
            delete commentsData[`${date}_${type}`];
            currentCommentCell.classList.remove('has-comment');
            document.getElementById('commentTextarea').value = '';
            
            showNotification('·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò ·É¨·Éê·Éò·É®·Éê·Éö·Éê', 'info');
            document.getElementById('deleteCommentBtn').style.display = 'none';
        }
        
        function closeCommentModal() {
            document.getElementById('commentModal').classList.remove('active');
            currentCommentCell = null;
        }
        
        // Confirmation modal handlers
        async function confirmDelete() {
            if (pendingDelete) {
                const { date, type, cell } = pendingDelete;
                
                delete scheduleData[date];
                delete commentsData[`${date}_${type}`];
                
                cell.className = `activity-cell ${type}-cell empty`;
                cell.textContent = '';
                cell.classList.remove('has-comment');
                
                await saveDataToFirebase();
                saveDataToLocalStorage();
                
                showNotification(`${type === 'german' ? '·Éí·Éî·É†·Éõ·Éê·Éú·É£·Éö·Éò' : 'MCG'} ·É¨·Éê·Éò·É®·Éê·Éö·Éê`, 'info');
                pendingDelete = null;
                
                document.getElementById('confirmModal').classList.remove('active');
            }
        }
        
        function cancelDelete() {
            pendingDelete = null;
            document.getElementById('confirmModal').classList.remove('active');
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadDataFromLocalStorage();
            
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Comment modal
            document.getElementById('closeCommentModal').addEventListener('click', closeCommentModal);
            document.getElementById('cancelCommentBtn').addEventListener('click', closeCommentModal);
            document.getElementById('saveCommentBtn').addEventListener('click', saveComment);
            document.getElementById('deleteCommentBtn').addEventListener('click', deleteComment);
            
            // Confirmation modal
            document.getElementById('closeConfirmModal').addEventListener('click', cancelDelete);
            document.getElementById('cancelConfirmBtn').addEventListener('click', cancelDelete);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
            
            // Close modals when clicking outside
            document.getElementById('commentModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeCommentModal();
                }
            });
            
            document.getElementById('confirmModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    cancelDelete();
                }
            });
            
            // Handle window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    if (currentUser) {
                        createSchedule();
                    }
                }, 250);
            });
            
            // Handle Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (document.getElementById('commentModal').classList.contains('active')) {
                        closeCommentModal();
                    }
                    if (document.getElementById('confirmModal').classList.contains('active')) {
                        cancelDelete();
                    }
                }
            });
        });
    </script>
</body>
</html>
