<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>განრიგი</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    background-color: #f5f7fa;
}

/* Login Page - LIGHT BACKGROUND */
.login-page {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
}

.login-container {
    background: #0f3460;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 420px;
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 1px solid #e0e0e0;
}

.login-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
}

.login-title {
    color: #CEDFF4;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
}

.login-subtitle {
    color: #CEDFF4;
    font-size: 12px;
    margin-bottom: 30px;
    font-weight: 400;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.login-input {
    padding: 14px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s;
    width: 100%;
    background: #ffffff;
    color: #333333;
}

.login-input:focus {
    outline: none;
    border-color: #CEDFF4;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
}

.login-input::placeholder {
    color: #CEDFF4;
}

.login-button {
    background: linear-gradient(90deg, #C4D7ED, #788FAA);
    color: #33465C;
    border: none;
    padding: 16px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    margin-top: 10px;
    letter-spacing: 0.5px;
}

.login-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px #33465C;
}

/* Main App Styling - FIXED WIDTH REMOVED */
.main-app {
    display: none;
    width: 100%; /* Take full width */
    padding: 0 0.5cm; /* 2cm from left and right edges */
}

.activity-cell.filled {
    font-weight: bold;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.german-cell.filled {
    font-size: 17px !important;
}

.mcg-cell.filled {
    font-size: 17px !important;
}

.german-cell.filled {
    font-size: 1.2em;
}

.mcg-cell.filled {
    font-size: 1.2em;
}

/* Header with logout */
.app-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding: 2px;
    border-radius: 12px;
    width: 100%; /* Full width within padding */
}

.app-title {
    color: #33465C;
    font-size: 20px;
    font-weight: 600;
}

.user-info {
    display: flex;
    align-items: center;
    font-size: 12px;
    gap: 15px;
}

.logout-button {
    background: linear-gradient(90deg, #f44336, #d32f2f);
    color: white;
    border: none;
    max-height: 200px;
    max-width: 200px;
    padding: 5px 5px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.logout-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3);
}

/* Notification Popup */
.notification {
    position: fixed;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: #2c3e50;
    color: white;
    padding: 12px 30px;
    border-radius: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    z-index: 1000;
    transition: top 0.3s ease-out;
    max-width: 500px;
    min-width: fit-content;
    width: auto;
    text-align: center;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.4;
    white-space: nowrap;
}

.notification.show {
    top: 20px;
}

/* Table Container */
.table-container {
    width: 100%; /* Full width within padding */
}

/* German Counter Styles */
.german-counter {
    background: linear-gradient(135deg, #1b5e20, #2e7d32);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    margin-left: 12px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 8px rgba(27, 94, 32, 0.3);
}

.german-counter i {
    font-size: 12px;
}

.month-box {
    margin-bottom: 20px;
    position: relative;
    background: white;
    font-size: 20px;
    color:#344455;
    font-weight: bold;
    border-radius: 12px;
    padding: 0px 5px 0px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    overflow-x: auto; /* Horizontal scrolling if needed */
    overflow-y: visible;
    position: relative;
    width: 100%; /* Full width within padding */
}

.month-box::before {
    content: '';
    position: sticky;
    left: 0;
    top: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, #6D849C, #344455);
    z-index: 1;
    display: block;
}

/* Month title - ADD THIS */
.month-title {
    font-size: 22px;
    font-weight: bold;
    color: #344455;
    margin-bottom: 15px;
    padding: 10px 5px;
    border-bottom: 2px solid #f0f0f0;
}
        
.schedule-grid {
    display: flex;
    flex-direction: column;
    min-width: fit-content; /* Ensure grid doesn't shrink */
    width: 100%; /* Full width */
}
        
/* Date Headers Row */
.date-headers {
    display: flex;
    margin-left: 120px; /* Space for labels */
    min-height: 40px;
    flex-wrap: nowrap; /* Keep dates in single row */
}
        
/* Date Header Cells - ROUNDED CORNERS */
.date-header {
    width: 60px; /* FIXED WIDTH - NOT CHANGED */
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    background: #C1C7CC;
    border: 1px solid #C1C7CC;
    font-size: 14px;
    color: #344455;
    flex-shrink: 0;
    border-radius: 8px;
    margin-right: 4px;
}
        
.date-header.weekend {
    background-color: #787F86;
    color: #344455;
    border-color: #787F86;
}
        
/* Activity Rows Container */
.activity-rows {
    display: flex;
    flex-direction: column;
    margin-top: 0px;
}
        
/* Activity Row */
.activity-row {
    display: flex;
    margin-bottom: 5px;
    align-items: center;
}
        
/* Activity Label */
.activity-label {
    width: 120px;
    padding: 0 15px;
    text-align: right;
    font-weight: 600;
    font-size: 14px;
    flex-shrink: 0;
}
        
.german-label {
    color: #4CAF50;
    font-weight: bold;
}
        
.mcg-label {
    color: #f44336;
    font-weight: bold;
}
        
/* Activity Cells Container */
.activity-cells {
    display: flex;
    flex-wrap: nowrap; /* Keep cells in single row */
    flex-grow: 1;
}
        
/* Activity Cell - ROUNDED CORNERS - FIXED WIDTH */
.activity-cell {
    width: 60px; /* FIXED WIDTH - NOT CHANGED */
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    font-weight: 600;
    font-size: 16px;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    flex-shrink: 0;
    overflow: hidden;
    margin-right: 4px;
    margin-bottom: 4px;
}
        
.activity-cell:hover {
    transform: scale(1.05);
    z-index: 2;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
        
/* German lesson cells - GREEN */
.german-cell.empty {
    background-color: white;
}
        
.german-cell.filled {
    background: linear-gradient(135deg, #4CAF50, #2E7D32);
    color: white;
    border-color: #136016;
}
        
/* MCG shift cells - RED */
.mcg-cell.empty {
    background-color: white;
}
        
.mcg-cell.filled {
    background: linear-gradient(135deg, #f44336, #d32f2f);
    color: white;
    border-color: #A51409;
}
        
/* Past date styling */
.past-date {
    opacity: 0.6;
}
        
.past-date .activity-cell {
    filter: grayscale(0.3);
    opacity: 0.7;
}
        
/* Comment indicator */
.has-comment::after {
    content: "\f017"; /* Clock icon for time comment */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 10px;
    opacity: 0.9;
    color: #FFFB00;
}
        
/* Comment Popup Modal with Time Selector */
.comment-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    align-items: center;
    justify-content: center;
}
        
.comment-modal-overlay.active {
    display: flex;
}
        
.comment-modal {
    background: white;
    border-radius: 16px;
    padding: 10px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.25);
}
        
        /* Time selector - 12-hour format */
.time-selector-container {
    margin-bottom: 5px;
}

.time-input-group {
    display: flex;
    align-items: center;
    gap: 5px;
}

.time-hour, .time-minute, .time-period {
    padding: 10px;
    border: 2px solid #e1e8ed;
    border-radius: 8px;
    font-size: 16px;
    background: white;
    cursor: pointer;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.time-hour {
    width: 70px;
}

.time-minute {
    width: 80px;
}

.time-period {
    width: 80px;
}

.time-separator {
    font-size: 18px;
    font-weight: 600;
    color: #2c3e50;
}

.time-hour:focus, .time-minute:focus, .time-period:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
}

.comment-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
    padding-bottom: 15px;
    border-bottom: 5px solid #ecf0f1;
}
        
.comment-modal-title {
    color: #2c3e50;
    font-size: 20px;
    font-weight: bold;
}
        
.comment-date-info {
    color: #7f8c8d;
    font-size: 14px;
    margin-top: 5px;
}
        
.close-comment-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #95a5a6;
    line-height: 1;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s;
}
        
.close-comment-modal:hover {
    background-color: #f5f6fa;
    color: #e74c3c;
}
        
/* Time selector - LONGER INPUT */
.time-selector {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 5px;
}
        
.time-selector label {
    font-weight: 600;
    color: #2c3e50;
    font-size: 14px;
    min-width: 60px;
}
        
        /* Confirmation Modal Comment Preview */
#commentPreview {
    display: none;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    border-left: 4px solid #4CAF50;
}

#commentPreviewTime {
    font-size: px; /* Increased from 12px */
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

#commentPreviewTime::before {
    content: "\f017"; /* Clock icon */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    font-size: 20px;
    color: #4CAF50;
}

#commentPreviewText {
    font-size: 15px;
    color: #344455;
    line-height: 1.5;
}

/* REMOVE ALL EXISTING PAST DATE CSS AND REPLACE WITH THESE */

/* Past date styling for date headers */
.past-date.date-header {
    opacity: 0.5;
    filter: grayscale(0.3);
    color: #666666;
    background-color: #cccccc !important;
    border-color: #cccccc !important;
}

/* For weekend past dates */
.past-date.date-header.weekend {
    background-color: #999999 !important;
    border-color: #999999 !important;
}

/* Past date styling for activity cells */
.activity-cell.past-date {
    filter: grayscale(0.5) brightness(0.9);
    opacity: 0.7;
}

.activity-cell.past-date:hover {
    opacity: 0.9;
    filter: grayscale(0.3) brightness(1);
}

/* Past German cells */
.german-cell.filled.past-date {
    background: linear-gradient(135deg, #8BC34A, #689F38) !important;
    opacity: 0.8;
}

/* Past MCG cells */
.mcg-cell.filled.past-date {
    background: linear-gradient(135deg, #EF5350, #E53935) !important;
    opacity: 0.8;
}

/* Past empty cells */
.activity-cell.empty.past-date {
    background-color: #f5f5f5 !important;
    border-color: #e0e0e0 !important;
}

/* VERY OLD DATES (more than 30 days) */

/* Very old date headers */
.past-date.very-old.date-header {
    opacity: 0.3;
    filter: grayscale(0.7);
    color: #888888;
    background-color: #dddddd !important;
    border-color: #dddddd !important;
}

/* Very old activity cells */
.activity-cell.past-date.very-old {
    filter: grayscale(0.8) brightness(0.8);
    opacity: 0.5;
}

/* Very old German cells */
.german-cell.filled.past-date.very-old {
    background: linear-gradient(135deg, #9CCC65, #7CB342) !important;
    opacity: 0.6;
}

/* Very old MCG cells */
.mcg-cell.filled.past-date.very-old {
    background: linear-gradient(135deg, #EF9A9A, #E57373) !important;
    opacity: 0.6;
}

.time-input {
    padding: 10px 15px;
    border: 2px solid #e1e8ed;
    border-radius: 8px;
    font-size: 16px;
    width: 140px; /* Longer input */
    font-family: 'Segoe UI', monospace;
}
        
/* Hide am/pm indicators */
.time-input::-webkit-datetime-edit-ampm-field {
    display: none;
}
        
.time-input[type=time]::-webkit-calendar-picker-indicator {
    background: #none;
}
        
.time-input:focus {
    outline: none;
    border-color: #e1e8ed;
}
        
.comment-textarea {
    width: 100%;
    height: 120px;
    padding: 15px;
    border: 2px solid #e1e8ed;
    border-radius: 10px;
    font-size: 16px;
    resize: vertical;
    margin-bottom: 20px;
    font-family: inherit;
}
        
.comment-textarea:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
}
        
.comment-modal-buttons {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}
        
.comment-modal-btn {
    padding: 12px 28px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}
        
.save-comment-btn {
    background: linear-gradient(90deg, #4CAF50, #2E7D32);
    color: white;
}
        
.delete-comment-btn {
    background: linear-gradient(90deg, #f44336, #d32f2f);
    color: white;
}
        
.cancel-comment-btn {
    background: #95a5a6;
    color: white;
}
        
.comment-modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
        
/* Current Comment Display */
.current-comment {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    border-left: 4px solid #4CAF50;
}
        
.comment-label {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
    font-size: 14px;
}
        
.comment-time {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 5px;
    font-style: italic;
}
        
/* Confirmation Modal */
.confirm-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}
        
.confirm-modal-overlay.active {
    display: flex;
}
        
.confirm-modal {
    background: white;
    border-radius: 12px;
    padding: 5px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
        
.confirm-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
    padding-bottom: 15px;
    border-bottom: 2px solid #ecf0f1;
}
        
.confirm-modal-title {
    color: #2c3e50;
    font-size: 18px;
    font-weight: bold;
}
        
.close-confirm-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #95a5a6;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s;
}
        
.close-confirm-modal:hover {
    background-color: #f5f6fa;
    color: #e74c3c;
}
        
.confirm-modal-message {
    color: #2c3e50;
    font-size: 16px;
    margin-bottom: 25px;
    line-height: 1.5;
}
        
.confirm-modal-buttons {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}
        
.confirm-modal-btn {
    padding: 10px 24px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}
        
.confirm-btn {
    background: linear-gradient(90deg, #f44336, #d32f2f);
    color: white;
}
        
.cancel-confirm-btn {
    background: #95a5a6;
    color: white;
}
        
.confirm-modal-btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}
        
/* Responsive Design */
@media (max-width: 768px) {
    .main-app {
        padding: 0 1cm; /* Less padding on mobile */
    }
    
    .date-header {
        width: 50px;
        height: 35px;
        font-size: 13px;
    }
    
    .activity-label {
        width: 100px;
        padding: 0 10px;
        font-size: 13px;
    }
    
    .month-title {
        font-size: 18px;
    }
    
    .activity-cell {
        width: 50px;
        height: 45px;
        font-size: 11px;
    }
    
    .date-headers {
        margin-left: 100px;
    }
    
    .time-input {
        width: 120px;
    }
}
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-title">ავტორიზაცია</div>
            <div class="login-subtitle">მორიგეობისა და გაკვეთილების ურთიერთშეთანხმება</div>
            <form id="loginForm" class="login-form">
                <input type="text" id="username" class="login-input" placeholder="მომხმარებელი" required>
                <input type="password" id="password" class="login-input" placeholder="პაროლი" required>
                <button type="submit" class="login-button">შესვლა</button>
            </form>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <!-- Header -->
        <div class="app-header">
            <div class="app-title">MCG ში მუშაობის განრიგის შეთანხმება გერმანულის გაკვეთილებზე გამოცხადების დაგეგმილ გრაფიკთან</div>
            <div class="user-info">
                <div style="font-weight: 500;">Alex</div>
                <button id="logoutBtn" class="logout-button">
                    <i class="fas fa-sign-out-alt"></i> გასვლა
                </button>
            </div>
        </div>
        
        <!-- Schedule Grid Container -->
        <div class="table-container" id="tableContainer">
            <!-- Month boxes will be generated here -->
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Comment Popup Modal with Time Selector -->
    <div id="commentModal" class="comment-modal-overlay">
        <div class="comment-modal">
            <div class="comment-modal-header">
                <div>
                    <div class="comment-modal-title" id="commentModalTitle"></div>
                    <div class="comment-date-info" id="commentDateInfo"></div>
                </div>
                <button id="closeCommentModal" class="close-comment-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="currentCommentContainer" style="display: none;">
                <div class="comment-label">მიმდინარე კომენტარი:</div>
                <div class="current-comment">
                    <div id="currentCommentTime"></div>
                    <div id="currentCommentText"></div>
                </div>
            </div>
            <div class="time-selector">
                <label for="commentTime">დრო:</label>
<div class="time-selector-container">
    <div class="time-input-group">
        <select id="commentHour" class="time-hour">
            <option value="01">1</option>
            <option value="02">2</option>
            <option value="03">3</option>
            <option value="04">4</option>
            <option value="05">5</option>
            <option value="06">6</option>
            <option value="07">7</option>
            <option value="08">8</option>
            <option value="09">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
        </select>
        <span class="time-separator">:</span>
        <select id="commentMinute" class="time-minute">
            <option value="00">00</option>
            <option value="05">05</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="30">30</option>
            <option value="35">35</option>
            <option value="40">40</option>
            <option value="45">45</option>
            <option value="50">50</option>
            <option value="55">55</option>
        </select>
        <select id="commentPeriod" class="time-period">
            <option value="AM">AM</option>
            <option value="PM">PM</option>
        </select>
    </div>
</div>
</div>
            <textarea id="commentTextarea" class="comment-textarea" placeholder="დაწერეთ კომენტარი..."></textarea>
            <div class="comment-modal-buttons">
                <button id="deleteCommentBtn" class="comment-modal-btn delete-comment-btn">
                    <i class="fas fa-trash"></i>წაშლა
                </button>
                <button id="cancelCommentBtn" class="comment-modal-btn cancel-comment-btn">
                    <i class="fas fa-times"></i>გაუქმება
                </button>
                <button id="saveCommentBtn" class="comment-modal-btn save-comment-btn">
                    <i class="fas fa-save"></i>შენახვა
                </button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="confirm-modal-overlay">
        <div class="confirm-modal">
            <div class="confirm-modal-header">
                <div class="confirm-modal-title">დადასტურება</div>
                <button id="closeConfirmModal" class="close-confirm-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalMessage" class="confirm-modal-message"></div>
<div id="commentPreview" style="display: none; background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10x; border-left: 4px solid #4CAF50;">
    <div id="commentPreviewTime" style="font-size: 20px; font-weight:bold; color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;"></div>
    <div id="commentPreviewText" style="font-size: 15px; color: #344455; line-height: 1.5;"></div>
</div>
            <div class="confirm-modal-buttons">
                <button id="cancelConfirmBtn" class="confirm-modal-btn cancel-confirm-btn">
                    <i class="fas fa-times"></i> გაუქმება
                </button>
                <button id="confirmDeleteBtn" class="confirm-modal-btn confirm-btn">
                    <i class="fas fa-trash"></i> წაშლა
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBePd7QF1DhWXmqwEYShA0oOKYeS8hAOLg",
            authDomain: "shifts-c5fb8.firebaseapp.com",
            databaseURL: "https://shifts-c5fb8-default-rtdb.firebaseio.com",
            projectId: "shifts-c5fb8",
            storageBucket: "shifts-c5fb8.firebasestorage.app",
            messagingSenderId: "44422916256",
            appId: "1:44422916256:web:1f430332196810435141c5",
            measurementId: "G-7ZLR5CKNTD"
        };
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }
        
        // Constants
        const VALID_USERNAME = "alex";
        const VALID_PASSWORD = "2911";
        
        // Current date
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth();
        const currentDay = today.getDate();
        
        // Georgian month names
        const monthNames = ["იანვარი", "თებერვალი", "მარტი", "აპრილი", "მაისი", "ივნისი", 
                           "ივლისი", "აგვისტო", "სექტემბერი", "ოქტომბერი", "ნოემბერი", "დეკემბერი"];
        
        // Georgian holidays (simplified list, you can add more)
        const georgianHolidays = {
            "12-27": "ახალი წელი",
            "12-28": "ახალი წელი",
            "12-29": "ახალი წელი",
            "12-30": "ახალი წელი",
            "12-31": "ახალი წელი",
            "1-1": "ახალი წელი",
            "1-2": "ახალი წელი",
            "1-3": "ახალი წელი",
            "1-4": "ახალი წელი",
            "1-4": "ახალი წელი",
            "1-6": "ახალი წელი",
            "1-7": "ახალი წელი",
            "1-8": "ახალი წელი",
            "1-9": "ახალი წელი",
            "1-19": "ნათლისღება",
            "3-3": "დედის დღე",
            "3-8": "ქალთა საერთაშორისო დღე",
            "4-9": "ეროვნული ერთიანობის დღე",
            "5-9": "ფაშიზმზე გამარჯვების დღე",
            "5-12": "წმინდა ანდრია პირველწოდებულის ხსენების დღე",
            "5-26": "დამოუკიდებლობის დღე",
            "8-28": "მარიამობა",
            "10-14": "მცხეთობის დღე",
            "11-23": "გიორგობა"
        };
        
        // Data storage
        let scheduleData = {};
        let commentsData = {};
        let currentUser = null;
        let pendingDelete = null;
        let currentCommentCell = null;
        
        // Helper functions
        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }
        
        function getDateKey(year, month, day) {
            return `${year}-${month + 1}-${day}`;
        }
        
        function isWeekend(year, month, day) {
            const date = new Date(year, month, day);
            const dayOfWeek = date.getDay();
            return dayOfWeek === 0 || dayOfWeek === 6; // 0 = Sunday, 6 = Saturday
        }
        
        function isHoliday(month, day) {
            const key = `${month + 1}-${day}`;
            return georgianHolidays[key] !== undefined;
        }
        
        function getHolidayName(month, day) {
            const key = `${month + 1}-${day}`;
            return georgianHolidays[key];
        }
        
function isPastDate(year, month, day) {
    const date = new Date(year, month, day);
    const now = new Date();
    
    // Compare dates only (not times)
    const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    const nowOnly = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    
    return dateOnly < nowOnly;
}
        
        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            if (type === 'error') {
                notification.style.background = 'linear-gradient(90deg, #f44336, #d32f2f)';
            } else if (type === 'success') {
                notification.style.background = 'linear-gradient(90deg, #4CAF50, #2E7D32)';
            } else {
                notification.style.background = 'linear-gradient(90deg, #2196F3, #1976D2)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Data Management Functions
        async function saveDataToFirebase() {
            if (!currentUser) return;
            
            try {
                const db = firebase.database();
                const userId = currentUser.name.toLowerCase();
                
                await db.ref(`schedules/${userId}`).set({
                    schedule: scheduleData,
                    comments: commentsData,
                    lastUpdated: new Date().toISOString()
                });
                
                console.log("Data saved to Firebase");
            } catch (error) {
                console.error("Error saving to Firebase:", error);
                saveDataToLocalStorage();
            }
        }
        
// Add this function after the isPastDate() function
function getPastDateClass(year, month, day) {
    const date = new Date(year, month, day);
    const now = new Date();
    
    const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    const nowOnly = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    
    const diffTime = nowOnly - dateOnly;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays > 30) return 'very-old'; // More than 30 days old
    if (diffDays > 7) return 'old'; // 1-4 weeks old
    return 'recent'; // Less than 1 week old
}

        async function loadDataFromFirebase() {
            if (!currentUser) return;
            
            try {
                const db = firebase.database();
                const userId = currentUser.name.toLowerCase();
                
                const snapshot = await db.ref(`schedules/${userId}`).once('value');
                const data = snapshot.val();
                
                if (data) {
                    scheduleData = data.schedule || {};
                    commentsData = data.comments || {};
                    console.log("Data loaded from Firebase");
                }
            } catch (error) {
                console.error("Error loading from Firebase:", error);
                loadDataFromLocalStorage();
            }
        }
        
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem('germanMcgSchedule', JSON.stringify(scheduleData));
                localStorage.setItem('germanMcgComments', JSON.stringify(commentsData));
                console.log("Data saved to localStorage");
            } catch (e) {
                console.error("Error saving to localStorage:", e);
            }
        }
        
        function loadDataFromLocalStorage() {
            try {
                const savedSchedule = localStorage.getItem('germanMcgSchedule');
                const savedComments = localStorage.getItem('germanMcgComments');
                
                if (savedSchedule) scheduleData = JSON.parse(savedSchedule);
                if (savedComments) commentsData = JSON.parse(savedComments);
                
                console.log("Data loaded from localStorage");
            } catch (e) {
                console.log("No saved data found in localStorage");
            }
        }
        
        // Authentication
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                currentUser = { name: 'Alex' };
                showNotification('წარმატებით შეხვედით სისტემაში!', 'success');
                
                await loadDataFromFirebase();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                createSchedule();
            } else {
                showNotification('არასწორი მომხმარებლის სახელი ან პაროლი!', 'error');
            }
        }
        
        function handleLogout() {
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('სისტემიდან გამოსული ხართ', 'info');
        }
        
        // Create Schedule with grid layout
function createSchedule() {
    const container = document.getElementById('tableContainer');
    container.innerHTML = '';
    
    // Get months from current month to August
    let year = currentYear;
    let month = currentMonth;
    
    while (true) {
        const daysInMonth = getDaysInMonth(year, month);
        const monthInfo = {
            year: year,
            month: month,
            name: monthNames[month],
            days: daysInMonth
        };
        
        // Create month box
        createMonthBox(container, monthInfo);
        
        if (month === 7) break; // Stop at August (month index 7)
        
        month++;
        if (month > 11) {
            month = 0;
            year++;
        }
    }
    
    // ADD THIS LINE HERE:
    setTimeout(updateGermanCounters, 100);
}
        
function createMonthBox(container, monthInfo) {
    const monthBox = document.createElement('div');
    monthBox.className = 'month-box';
    
    // Month title WITH COUNTER
    const monthTitle = document.createElement('div');
    monthTitle.className = 'month-title';
    
    // Create title container
    const titleContainer = document.createElement('div');
    titleContainer.style.display = 'flex';
    titleContainer.style.alignItems = 'center';
    titleContainer.style.justifyContent = 'space-between';
    titleContainer.style.width = '100%';
    
    // Month name
    const monthName = document.createElement('div');
    monthName.textContent = monthInfo.name;
    
    // German counter
    const germanCounter = document.createElement('div');
    germanCounter.className = 'german-counter';
    germanCounter.id = `german-counter-${monthInfo.year}-${monthInfo.month}`;
    
    // Count German lessons for this month
    let germanCount = 0;
    for (let day = 1; day <= monthInfo.days; day++) {
        const dateKey = getDateKey(monthInfo.year, monthInfo.month, day);
        if (scheduleData[dateKey] === 'german') {
            germanCount++;
        }
    }
    
    germanCounter.innerHTML = `<i class="fas fa-chalkboard-teacher"></i> GER: ${germanCount}`;
    
    // Add elements to title container
    titleContainer.appendChild(monthName);
    titleContainer.appendChild(germanCounter);
    
    monthTitle.appendChild(titleContainer);
    monthBox.appendChild(monthTitle);
    
    // Create grid container
    const grid = document.createElement('div');
    grid.className = 'schedule-grid';
    
    // Create date headers
    const dateHeaders = document.createElement('div');
    dateHeaders.className = 'date-headers';
    
    // CHANGE THIS: Always start from day 1, not from current day
    const startDay = 1; // Changed from conditional to always 1
    
for (let day = startDay; day <= monthInfo.days; day++) {
    const dateHeader = document.createElement('div');
    dateHeader.className = 'date-header';
    dateHeader.textContent = day;
    
    // Add weekend/holiday styling
    if (isWeekend(monthInfo.year, monthInfo.month, day) || isHoliday(monthInfo.month, day)) {
        dateHeader.classList.add('weekend');
        const holidayName = getHolidayName(monthInfo.month, day);
        if (holidayName) {
            dateHeader.title = holidayName;
        }
    }
    
    // Add past date class to date headers too
    if (isPastDate(monthInfo.year, monthInfo.month, day)) {
        dateHeader.classList.add('past-date');
        // Optional: add specific class based on how old
        const pastClass = getPastDateClass(monthInfo.year, monthInfo.month, day);
        if (pastClass && pastClass !== 'recent') {
            dateHeader.classList.add(pastClass);
        }
    }
    
    dateHeaders.appendChild(dateHeader);
}

grid.appendChild(dateHeaders);
    
    // Create activity rows container
    const activityRows = document.createElement('div');
    activityRows.className = 'activity-rows';
    
    // German row
    const germanRow = createActivityRow('german', monthInfo);
    activityRows.appendChild(germanRow);
    
    // MCG row
    const mcgRow = createActivityRow('mcg', monthInfo);
    activityRows.appendChild(mcgRow);
    
    grid.appendChild(activityRows);
    monthBox.appendChild(grid);
    container.appendChild(monthBox);
}
        
// Function to update all German counters
function updateGermanCounters() {
    // Get all month boxes
    const monthBoxes = document.querySelectorAll('.month-box');
    
    // Get current year/month for reference
    const currentDate = new Date();
    const currentYear = currentDate.getFullYear();
    
    monthBoxes.forEach((monthBox, index) => {
        // Find the counter inside the month box
        const germanCounter = monthBox.querySelector('.german-counter');
        if (!germanCounter) return;
        
        // Get the month title text
        const monthTitle = monthBox.querySelector('.month-title div:first-child');
        if (!monthTitle) return;
        
        const monthName = monthTitle.textContent.trim();
        const monthIndex = monthNames.indexOf(monthName);
        
        if (monthIndex === -1) return;
        
        // Determine the year
        let year = currentYear;
        // If month index is less than current month, it's next year
        if (monthIndex < currentMonth && index === 0) {
            // First month box might be current month
        } else if (monthIndex < monthIndex) {
            // This logic might need adjustment based on your schedule display
        }
        
        // Count ALL German lessons for this month (past and future)
        let germanCount = 0;
        const daysInMonth = getDaysInMonth(year, monthIndex);
        
        for (let day = 1; day <= daysInMonth; day++) {
            const dateKey = getDateKey(year, monthIndex, day);
            if (scheduleData[dateKey] === 'german') {
                germanCount++;
            }
        }
        
        germanCounter.innerHTML = `<i class="fas fa-chalkboard-teacher"></i> GER: ${germanCount}`;
    });
}

// Helper function to format time for display
function formatTimeForDisplay(time24) {
    if (!time24) return '';
    
    const [hour, minute] = time24.split(':');
    const hourNum = parseInt(hour);
    
    if (hourNum >= 12) {
        const hour12 = hourNum === 12 ? '12' : (hourNum - 12).toString().padStart(2, '0');
        return `${hour12}:${minute} PM`;
    } else {
        const hour12 = hourNum === 0 ? '12' : hourNum.toString().padStart(2, '0');
        return `${hour12}:${minute} AM`;
    }
}

        
function createActivityRow(activityType, monthInfo) {
    const row = document.createElement('div');
    row.className = 'activity-row';
    
    // Activity label
    const label = document.createElement('div');
    label.className = `activity-label ${activityType}-label`;
    label.textContent = activityType === 'german' ? 'გერმანული' : 'MCG';
    row.appendChild(label);
    
    // Activity cells container
    const cellsContainer = document.createElement('div');
    cellsContainer.className = 'activity-cells';
    
    // CHANGE THIS: Always start from day 1, not from current day
    const startDay = 1; // Changed from conditional to always 1
    
    for (let day = startDay; day <= monthInfo.days; day++) {
        const dateKey = getDateKey(monthInfo.year, monthInfo.month, day);
        
        const cell = document.createElement('div');
        cell.className = `activity-cell ${activityType}-cell empty`;
        
        // Check if this date has activity
        const hasActivity = scheduleData[dateKey] === activityType;
        const hasComment = commentsData[`${dateKey}_${activityType}`];
        
        if (hasActivity) {
            cell.classList.remove('empty');
            cell.classList.add('filled');
            cell.textContent = activityType === 'german' ? 'GER' : 'MCG';
        }
        
        if (hasComment) {
            cell.classList.add('has-comment');
        }
        
        // Add past date class
        if (isPastDate(monthInfo.year, monthInfo.month, day)) {
            cell.classList.add('past-date');
            // Optional: add specific class based on how old
            const pastClass = getPastDateClass(monthInfo.year, monthInfo.month, day);
            if (pastClass) cell.classList.add(pastClass);
        }
        
        cell.dataset.date = dateKey;
        cell.dataset.type = activityType;
        
        cell.addEventListener('click', handleCellClick);
        cell.addEventListener('contextmenu', handleRightClick);
        
        cellsContainer.appendChild(cell);
    }
    
    row.appendChild(cellsContainer);
    return row;
}

        
        // Event handlers
function handleCellClick(e) {
    const cell = e.currentTarget;
    const date = cell.dataset.date;
    const type = cell.dataset.type;
    
    const hasActivity = scheduleData[date] === type;
    const hasComment = commentsData[`${date}_${type}`];
    
    if (hasActivity && hasComment) {
        // Show confirmation modal with comment preview
        pendingDelete = { date, type, cell };
        
        const [year, month, day] = date.split('-');
        const georgianMonth = monthNames[parseInt(month) - 1];
        const commentData = commentsData[`${date}_${type}`];
        
        document.getElementById('modalMessage').innerHTML = 
            `<strong>${day} ${georgianMonth}, ${year}</strong><br>` +
            `დარწმუნებული ხართ, რომ გსურთ "${type === 'german' ? 'გერმანული' : 'MCG'}" წაშლა?`;
        
        // Show comment preview
        if (commentData) {
            document.getElementById('commentPreview').style.display = 'block';
            document.getElementById('commentPreviewTime').textContent = commentData.time ? `გამოცხადების დრო: ${commentData.time}` : '';
            document.getElementById('commentPreviewText').textContent = commentData.text || '';
        }
        
        document.getElementById('confirmModal').classList.add('active');
    } 
    // REMOVE THIS CHECK - ALLOW CLICKING ON PAST DATES
    // else if (isPastDate(...date.split('-').map(Number))) {
    //     showNotification('წარსული თარიღის მონიშვნა შეუძლებელია', 'error');
    // } 
    else {
        toggleEvent(cell, date, type);
    }
}
        
function handleRightClick(e) {
    e.preventDefault();
    const cell = e.currentTarget;
    const date = cell.dataset.date;
    const type = cell.dataset.type;
    
    currentCommentCell = cell;
    
    const commentKey = `${date}_${type}`;
    const commentData = commentsData[commentKey] || { text: '', time: '19:00' };
    const [year, month, day] = date.split('-');
    const georgianMonth = monthNames[parseInt(month) - 1];
    
    // Show comment popup modal
    document.getElementById('commentModalTitle').textContent = 
        `${type === 'german' ? 'გერმანული' : 'MCG'} - კომენტარის დამატება`;
    document.getElementById('commentDateInfo').textContent = 
        `${day} ${georgianMonth}, ${year}`;
    document.getElementById('commentTextarea').value = commentData.text || '';
    
    // Set time values from existing comment or default - YOUR CODE HERE
    const commentTime = commentData.time || '19:00';
    let hour = '07';
    let minute = '00';
    let period = 'PM';
    
    // Parse 24-hour format to 12-hour format
    if (commentTime) {
        const [timeHour, timeMinute] = commentTime.split(':');
        const hour24 = parseInt(timeHour);
        
        if (hour24 >= 12) {
            period = 'PM';
            hour = hour24 === 12 ? '12' : (hour24 - 12).toString().padStart(2, '0');
        } else {
            period = 'AM';
            hour = hour24 === 0 ? '12' : hour24.toString().padStart(2, '0');
        }
        minute = timeMinute;
    }
    
    document.getElementById('commentHour').value = hour;
    document.getElementById('commentMinute').value = minute;
    document.getElementById('commentPeriod').value = period;
    
    // Show/hide existing comment
    const currentCommentContainer = document.getElementById('currentCommentContainer');
    const currentCommentText = document.getElementById('currentCommentText');
    const currentCommentTime = document.getElementById('currentCommentTime');
    
    if (commentData.text && commentData.text.trim()) {
        currentCommentContainer.style.display = 'block';
        currentCommentText.textContent = commentData.text;
        // Format time for display
        currentCommentTime.textContent = commentData.time ? `დრო: ${formatTimeForDisplay(commentData.time)}` : '';
    } else {
        currentCommentContainer.style.display = 'none';
    }
    
    // Show/hide delete button based on whether comment exists
    const deleteBtn = document.getElementById('deleteCommentBtn');
    deleteBtn.style.display = (commentData.text && commentData.text.trim()) ? 'flex' : 'none';
    
    document.getElementById('commentModal').classList.add('active');
}
        
async function toggleEvent(cell, date, type) {
    // REMOVE THIS CHECK - ALLOW MODIFYING PAST DATES
    // if (isPastDate(...date.split('-').map(Number))) {
    //     showNotification('წარსული თარიღის მონიშვნა შეუძლებელია', 'error');
    //     return;
    // }
    
    const hasActivity = scheduleData[date] === type;
    
    if (hasActivity) {
        // Remove activity
        delete scheduleData[date];
        cell.className = `activity-cell ${type}-cell empty`;
        cell.textContent = '';
        
        // Remove comment
        delete commentsData[`${date}_${type}`];
        cell.classList.remove('has-comment');
        
        // Update notification messages based on type
        if (type === 'german') {
            showNotification('გაკვეთილი წაიშალა', 'info');
        } else {
            showNotification('მორიგეობა წაიშალა', 'info');
        }
    } else {
        // Add activity
        scheduleData[date] = type;
        cell.className = `activity-cell ${type}-cell filled`;
        cell.textContent = type === 'german' ? 'GER' : 'MCG';
        cell.style.fontSize = '12px';
        cell.style.display = 'flex';
        cell.style.alignItems = 'center';
        cell.style.justifyContent = 'center';
        
        // Update notification messages based on type
        if (type === 'german') {
            showNotification('გაკვეთილი დაემატა', 'success');
        } else {
            showNotification('მორიგეობა დაემატა', 'success');
        }
    }
    
    await saveDataToFirebase();
    saveDataToLocalStorage();
    updateGermanCounters();
}

function saveComment() {
    if (!currentCommentCell) return;
    
    const date = currentCommentCell.dataset.date;
    const type = currentCommentCell.dataset.type;
    const commentText = document.getElementById('commentTextarea').value.trim();
    
    // Get 12-hour time values - YOUR CODE HERE
    const hour12 = document.getElementById('commentHour').value;
    const minute = document.getElementById('commentMinute').value;
    const period = document.getElementById('commentPeriod').value;
    
    // Convert to 24-hour format
    let hour24 = parseInt(hour12);
    if (period === 'PM' && hour24 < 12) {
        hour24 += 12;
    } else if (period === 'AM' && hour24 === 12) {
        hour24 = 0;
    }
    
    const commentTime = `${hour24.toString().padStart(2, '0')}:${minute}`;
    
    // Time is required
    if (!commentTime) {
        showNotification('გთხოვთ მიუთითოთ დრო', 'error');
        return;
    }
    
    // Save both time and additional comment
    commentsData[`${date}_${type}`] = {
        text: commentText,
        time: commentTime
    };
    currentCommentCell.classList.add('has-comment');
    
    // Show notification with time - use formatted time for display
    const displayTime = formatTimeForDisplay(commentTime);
    if (commentText) {
        showNotification(`დრო და კომენტარი შენახულია (${displayTime})`, 'success');
    } else {
        showNotification(`დრო შენახულია (${displayTime})`, 'success');
    }
    
    saveDataToFirebase();
    saveDataToLocalStorage();
    closeCommentModal();
}
        
function deleteComment() {
    if (!currentCommentCell) return;
    
    const date = currentCommentCell.dataset.date;
    const type = currentCommentCell.dataset.type;
    
    const commentKey = `${date}_${type}`;
    const commentData = commentsData[commentKey];
    
    if (commentData) {
        pendingDelete = { date, type, cell: currentCommentCell, commentOnly: true };
        
        const [year, month, day] = date.split('-');
        const georgianMonth = monthNames[parseInt(month) - 1];
        
        document.getElementById('modalMessage').innerHTML = 
            `<strong>${day} ${georgianMonth}, ${year}</strong><br>` +
            `დარწმუნებული ხართ, რომ გსურთ კომენტარის წაშლა?`;
        
        // Show comment preview
        document.getElementById('commentPreview').style.display = 'block';
        document.getElementById('commentPreviewTime').textContent = 
            commentData.time ? `დრო: ${formatTimeForDisplay(commentData.time)}` : '';
        document.getElementById('commentPreviewText').textContent = commentData.text || '';
        
        // Update confirm button text
        document.getElementById('confirmDeleteBtn').innerHTML = '<i class="fas fa-trash"></i> კომენტარის წაშლა';
        
        document.getElementById('confirmModal').classList.add('active');
    }
}
        
        function closeCommentModal() {
            document.getElementById('commentModal').classList.remove('active');
            document.getElementById('commentTextarea').value = '';
            document.getElementById('commentTime').value = '19:00';
            document.getElementById('currentCommentContainer').style.display = 'none';
            currentCommentCell = null;
        }
        
        // Confirmation modal handlers
        async function confirmDelete() {
            if (pendingDelete) {
                const { date, type, cell, commentOnly } = pendingDelete;
                
                if (commentOnly) {
                    // Delete only the comment
                    delete commentsData[`${date}_${type}`];
                    cell.classList.remove('has-comment');
                    
                    showNotification('წაიშალა', 'info');
                } else {
                    // Delete activity and comment
                    delete scheduleData[date];
                    delete commentsData[`${date}_${type}`];
                    
                    cell.className = `activity-cell ${type}-cell empty`;
                    cell.textContent = '';
                    cell.classList.remove('has-comment');
                    
                    // Update notification messages based on type
                    if (type === 'german') {
                        showNotification('გაკვეთილი წაიშალა', 'info');
                    } else {
                        showNotification('მორიგეობა წაიშალა', 'info');
                    }
                }
                
                await saveDataToFirebase();
                saveDataToLocalStorage();
                updateGermanCounters();
                
                // Reset confirm button text
                document.getElementById('confirmDeleteBtn').innerHTML = '<i class="fas fa-trash"></i> წაშლა';
                
                pendingDelete = null;
                
                document.getElementById('confirmModal').classList.remove('active');
                document.getElementById('commentPreview').style.display = 'none';
            }
        }
        
        function cancelDelete() {
            pendingDelete = null;
            document.getElementById('confirmModal').classList.remove('active');
            document.getElementById('commentPreview').style.display = 'none';
            
            // Reset confirm button text
            document.getElementById('confirmDeleteBtn').innerHTML = '<i class="fas fa-trash"></i> წაშლა';
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadDataFromLocalStorage();
            
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Comment modal
            document.getElementById('closeCommentModal').addEventListener('click', closeCommentModal);
            document.getElementById('cancelCommentBtn').addEventListener('click', closeCommentModal);
            document.getElementById('saveCommentBtn').addEventListener('click', saveComment);
            document.getElementById('deleteCommentBtn').addEventListener('click', deleteComment);
            
            // Confirmation modal
            document.getElementById('closeConfirmModal').addEventListener('click', cancelDelete);
            document.getElementById('cancelConfirmBtn').addEventListener('click', cancelDelete);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
            
            // Close modals when clicking outside
            document.getElementById('commentModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeCommentModal();
                }
            });
            
            document.getElementById('confirmModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    cancelDelete();
                }
            });
            
            // Handle window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    if (currentUser) {
                        createSchedule();
                    }
                }, 250);
            });
            
            // Handle Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (document.getElementById('commentModal').classList.contains('active')) {
                        closeCommentModal();
                    }
                    if (document.getElementById('confirmModal').classList.contains('active')) {
                        cancelDelete();
                    }
                }
            });
        });
    </script>
</body>
</html>
